component CardDisplay inherits Rectangle {
    in property <string> card_value: "";
    in property <bool> face_up: true;
    in property <bool> is_red: false;
    
    background: face_up ? (card_value != "" ? #ffffff : #1a1a2e) : #1a1a2e;
    border-radius: 3px;
    border-width: 1px;
    border-color: face_up ? #cccccc : #333;
    
    if face_up && card_value != "" : Text {
        text: card_value;
        font-size: 10px;
        font-weight: 700;
        color: is_red ? #dc143c : #1a1a1a;
        horizontal-alignment: center;
        vertical-alignment: center;
    }
}

component PlayerAreaCompact inherits Rectangle {
    in property <string> name: "";
    in property <float> chips: 0;
    in property <float> current_bet: 0;
    in property <string> hole_card1: "";
    in property <string> hole_card2: "";
    in property <bool> hole_card1_red: false;
    in property <bool> hole_card2_red: false;
    in property <bool> is_acting: false;
    in property <bool> is_folded: false;
    in property <bool> is_dealer: false;
    
    background: is_acting ? #4a3a00 : #2a2a2a;
    border-radius: 6px;
    border-width: 1px;
    border-color: is_acting ? #ffd700 : #444;
    
    if is_dealer : Rectangle {
        width: 14px;
        height: 14px;
        x: 3px;
        y: 3px;
        border-radius: 7px;
        background: #ffffff;
        border-width: 1px;
        border-color: #ffd700;
        
        Text {
            text: "D";
            font-size: 7px;
            font-weight: 700;
            color: #1a1a1a;
            horizontal-alignment: center;
            vertical-alignment: center;
        }
    }
    
    Text {
        text: name;
        font-size: 9px;
        font-weight: 600;
        color: #ffffff;
        x: (parent.width - self.width) / 2;
        y: 3px;
    }
    
    Text {
        text: chips;
        font-size: 10px;
        font-weight: 600;
        color: #ffd700;
        x: (parent.width - self.width) / 2;
        y: 14px;
    }
    
    if current_bet > 0 : Text {
        text: "Bet: " + current_bet;
        font-size: 7px;
        color: #aaaaaa;
        x: (parent.width - self.width) / 2;
        y: 26px;
    }
    
    Rectangle {
        x: (parent.width - 48px) / 2;
        y: 36px;
        width: 48px;
        height: 28px;
        
        CardDisplay {
            card_value: hole_card1;
            face_up: true;
            is_red: hole_card1_red;
            x: 0;
            y: 0;
            width: 22px;
            height: 26px;
        }
        CardDisplay {
            card_value: hole_card2;
            face_up: true;
            is_red: hole_card2_red;
            x: 24px;
            y: 0;
            width: 22px;
            height: 26px;
        }
    }
    
    if is_folded : Text {
        text: "FOLDED";
        font-size: 10px;
        font-weight: 600;
        color: #ff4444;
        x: (parent.width - self.width) / 2;
        y: (parent.height - self.height) / 2;
    }
    
    if is_acting : Rectangle {
        width: 6px;
        height: 6px;
        x: parent.width - 10px;
        y: 4px;
        border-radius: 3px;
        background: #00ff00;
    }
}

component ActionButton inherits Rectangle {
    in property <string> text: "";
    in property <color> bg_color: #4a6fa5;
    in property <bool> enabled: true;
    
    background: enabled ? bg_color : #555555;
    border-radius: 4px;
    
    Text {
        text: parent.text;
        font-size: 11px;
        font-weight: 600;
        color: #ffffff;
        horizontal-alignment: center;
        vertical-alignment: center;
    }
}

component BetSlider inherits Rectangle {
    in property <float> value: 0;
    in property <float> min: 0;
    in property <float> max: 100;
    in property <string> label: "";
    
    background: #1a1a1a;
    border-radius: 4px;
    
    Text {
        text: label + ": " + value;
        font-size: 10px;
        color: #ffd700;
        x: 4px;
        y: 2px;
    }
    
    Rectangle {
        x: 4px;
        y: 18px;
        width: parent.width - 8px;
        height: 6px;
        background: #333;
        border-radius: 3px;
        
        Rectangle {
            x: 0;
            y: 0;
            width: (parent.width - 8px) * ((value - min) / (max - min));
            height: 6px;
            background: #ffd700;
            border-radius: 3px;
        }
    }
}

export component PokerApp inherits Window {
    in property <string> player1_name: "Player 1";
    in property <string> player2_name: "Player 2";
    in property <float> player1_chips: 10000;
    in property <float> player2_chips: 10000;
    in property <float> pot_size: 0;
    in property <float> current_bet: 0;
    in property <string> game_stage: "preflop";
    in property <int> dealer_position: 0;
    in property <string> message: "Game Starting...";
    in property <bool> show_hole_cards: true;
    
    in property <string> p1_card1: "";
    in property <string> p1_card2: "";
    in property <string> p2_card1: "";
    in property <string> p2_card2: "";
    
    in property <bool> p1_card1_red: false;
    in property <bool> p1_card2_red: false;
    in property <bool> p2_card1_red: false;
    in property <bool> p2_card2_red: false;
    
    in property <string> flop1: "";
    in property <string> flop2: "";
    in property <string> flop3: "";
    in property <string> turn: "";
    in property <string> river: "";
    
    in property <bool> flop1_red: false;
    in property <bool> flop2_red: false;
    in property <bool> flop3_red: false;
    in property <bool> turn_red: false;
    in property <bool> river_red: false;
    
    in property <bool> p1_acting: false;
    in property <bool> p2_acting: false;
    in property <bool> p1_folded: false;
    in property <bool> p2_folded: false;
    in property <float> p1_current_bet: 0;
    in property <float> p2_current_bet: 0;
    
    in property <bool> can_check: false;
    in property <bool> can_call: false;
    in property <bool> can_bet: false;
    in property <bool> can_raise: false;
    in property <bool> can_fold: false;
    in property <float> call_amount: 0;
    in property <float> bet_amount: 0;
    in property <float> min_bet: 0;
    in property <float> max_bet: 0;
    
    title: "Poker Simulation";
    min-width: 320px;
    min-height: 480px;
    
    Rectangle {
        width: parent.width;
        height: parent.height;
        background: #1a472a;
        
        Rectangle {
            width: min(parent.width * 0.94, 360px);
            height: min(parent.height * 0.58, 280px);
            x: (parent.width - self.width) / 2;
            y: parent.height * 0.01;
            border-radius: 16px;
            background: #2d5a3d;
            border-width: 6px;
            border-color: #8b4513;
            
            Rectangle {
                width: parent.width - 14px;
                height: parent.height - 14px;
                x: 7px;
                y: 7px;
                border-radius: 12px;
                background: #356e4b;
            }
            
            PlayerAreaCompact {
                name: player2_name;
                chips: player2_chips;
                current_bet: p2_current_bet;
                hole_card1: p2_card1;
                hole_card2: p2_card2;
                hole_card1_red: p2_card1_red;
                hole_card2_red: p2_card2_red;
                is_acting: p2_acting;
                is_folded: p2_folded;
                is_dealer: dealer_position == 1;
                x: (parent.width - min(parent.width * 0.38, 120px)) / 2;
                y: 8px;
                width: min(parent.width * 0.38, 120px);
                height: min(parent.height * 0.18, 52px);
            }
            
            Rectangle {
                width: min(parent.width * 0.7, 220px);
                height: 18px;
                x: (parent.width - self.width) / 2;
                y: parent.height * 0.38;
                border-radius: 5px;
                background: #1a1a1a;
                border-width: 1px;
                border-color: #ffd700;
                
                Text {
                    text: "Pot: " + pot_size;
                    font-size: 10px;
                    font-weight: 600;
                    color: #ffd700;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }
            }
            
            Rectangle {
                width: min(parent.width * 0.85, 260px);
                height: 28px;
                x: (parent.width - self.width) / 2;
                y: parent.height * 0.46;
                
                CardDisplay {
                    card_value: flop1;
                    face_up: flop1 != "";
                    is_red: flop1_red;
                    x: 0;
                    y: 0;
                    width: min(parent.width * 0.14, 36px);
                    height: self.width * 1.3;
                }
                CardDisplay {
                    card_value: flop2;
                    face_up: flop2 != "";
                    is_red: flop2_red;
                    x: min(parent.width * 0.17, 44px);
                    y: 0;
                    width: min(parent.width * 0.14, 36px);
                    height: self.width * 1.3;
                }
                CardDisplay {
                    card_value: flop3;
                    face_up: flop3 != "";
                    is_red: flop3_red;
                    x: min(parent.width * 0.34, 88px);
                    y: 0;
                    width: min(parent.width * 0.14, 36px);
                    height: self.width * 1.3;
                }
                
                CardDisplay {
                    card_value: turn;
                    face_up: turn != "";
                    is_red: turn_red;
                    x: min(parent.width * 0.51, 132px);
                    y: 0;
                    width: min(parent.width * 0.14, 36px);
                    height: self.width * 1.3;
                }
                
                CardDisplay {
                    card_value: river;
                    face_up: river != "";
                    is_red: river_red;
                    x: min(parent.width * 0.68, 176px);
                    y: 0;
                    width: min(parent.width * 0.14, 36px);
                    height: self.width * 1.3;
                }
            }
            
            Rectangle {
                width: min(parent.width * 0.2, 60px);
                height: 14px;
                x: (parent.width - self.width) / 2;
                y: parent.height * 0.08;
                border-radius: 4px;
                background: #4a6fa5;
                
                Text {
                    text: game_stage;
                    font-size: 7px;
                    font-weight: 600;
                    color: #ffffff;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }
            }
            
            Rectangle {
                width: min(parent.width * 0.5, 150px);
                height: 16px;
                x: (parent.width - self.width) / 2;
                y: parent.height * 0.7;
                border-radius: 4px;
                background: rgba(0, 0, 0, 0.6);
                border-width: 1px;
                border-color: rgba(255, 255, 255, 0.2);
                
                Text {
                    text: message;
                    font-size: 8px;
                    color: #ffffff;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }
            }
            
            PlayerAreaCompact {
                name: player1_name;
                chips: player1_chips;
                current_bet: p1_current_bet;
                hole_card1: p1_card1;
                hole_card2: p1_card2;
                hole_card1_red: p1_card1_red;
                hole_card2_red: p1_card2_red;
                is_acting: p1_acting;
                is_folded: p1_folded;
                is_dealer: dealer_position == 0;
                x: (parent.width - min(parent.width * 0.38, 120px)) / 2;
                y: parent.height - 60px;
                width: min(parent.width * 0.38, 120px);
                height: min(parent.height * 0.18, 52px);
            }
        }
        
        Rectangle {
            width: min(parent.width * 0.94, 360px);
            height: 68px;
            x: (parent.width - self.width) / 2;
            y: parent.height * 0.6;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            border-width: 1px;
            border-color: rgba(255, 255, 255, 0.15);
            
            BetSlider {
                x: 6px;
                y: 4px;
                width: parent.width - 12px;
                height: 26px;
                value: bet_amount;
                min: min_bet;
                max: max_bet;
                label: "Bet";
            }
            
            Rectangle {
                x: 4px;
                y: 32px;
                width: parent.width - 8px;
                height: 34px;
                
                ActionButton {
                    text: "Fold";
                    bg_color: #aa4444;
                    enabled: can_fold;
                    x: 0;
                    y: 0;
                    width: min(parent.width * 0.22, 72px);
                    height: 32px;
                }
                ActionButton {
                    text: "Check";
                    bg_color: #4a7fa5;
                    enabled: can_check;
                    x: min(parent.width * 0.24, 78px);
                    y: 0;
                    width: min(parent.width * 0.22, 72px);
                    height: 32px;
                }
                ActionButton {
                    text: "Call " + call_amount;
                    bg_color: #4a9a5a;
                    enabled: can_call;
                    x: min(parent.width * 0.48, 156px);
                    y: 0;
                    width: min(parent.width * 0.24, 78px);
                    height: 32px;
                }
                ActionButton {
                    text: "Raise";
                    bg_color: #9a7a4a;
                    enabled: can_raise;
                    x: min(parent.width * 0.74, 240px);
                    y: 0;
                    width: min(parent.width * 0.24, 78px);
                    height: 32px;
                }
            }
        }
    }
}
